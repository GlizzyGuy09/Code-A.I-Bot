<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Code Bot - AI Chat</title>
<style>
  /* -- RESET & BASE -- */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
    font-family: 'Orbitron', sans-serif;
    user-select: none;
  }
  html, body {
    height: 100%; background: #010a13;
    color: #0ff; overflow-x: hidden;
    transition: background 0.5s ease, color 0.5s ease;
  }
  a {
    color: #0ff; text-decoration: none;
  }
  /* -- LAYOUT -- */
  header {
    position: fixed; top: 0; left: 0; right: 0;
    background: #01101e;
    padding: 1rem 2rem;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 0 15px #00f4ff;
    z-index: 10;
  }
  header h1 {
    font-size: 2.4rem;
    text-shadow: 0 0 10px #0ff;
  }
  #settingsBtn {
    cursor: pointer;
    font-size: 1.8rem;
    color: #0ff;
    transition: color 0.3s ease;
  }
  #settingsBtn:hover {
    color: #fff;
  }
  main {
    max-width: 900px;
    margin: 100px auto 30px auto;
    background: rgba(0, 255, 255, 0.1);
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 0 25px #00ffff77;
    min-height: 600px;
    display: flex;
    flex-direction: column;
  }
  /* -- CHAT -- */
  #chatBox {
    flex-grow: 1;
    overflow-y: auto;
    border-radius: 15px;
    background: #011426;
    padding: 1rem;
    box-shadow: inset 0 0 15px #00fff7aa;
  }
  .message {
    margin: 1rem 0;
    padding: 0.8rem 1rem;
    border-radius: 20px;
    max-width: 75%;
    line-height: 1.3;
    font-size: 1.1rem;
    box-shadow: 0 0 15px #00fff7aa;
    animation: fadeIn 0.3s ease;
  }
  .userMessage {
    background: linear-gradient(120deg, #00fff7, #00b7f7);
    color: #000;
    align-self: flex-end;
    text-align: right;
  }
  .botMessage {
    background: linear-gradient(120deg, #05192f, #0e5270);
    color: #0ff;
    align-self: flex-start;
    text-align: left;
  }
  /* -- INPUT AREA -- */
  #inputArea {
    margin-top: 15px;
    display: flex;
    gap: 10px;
  }
  #userInput {
    flex-grow: 1;
    border-radius: 25px;
    padding: 1rem 1.5rem;
    border: none;
    font-size: 1.3rem;
    background: #011426;
    color: #0ff;
    box-shadow: inset 0 0 10px #00fff7aa;
    outline: none;
    transition: background 0.3s ease;
  }
  #userInput::placeholder {
    color: #0ff7;
  }
  #sendBtn {
    background: #00fff7;
    border: none;
    border-radius: 25px;
    color: #000;
    font-weight: 700;
    padding: 0 2rem;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 0 20px #00fff7;
    transition: transform 0.2s ease;
  }
  #sendBtn:hover {
    transform: scale(1.1);
  }
  /* -- SETTINGS PANEL -- */
  #settingsPanel {
    position: fixed;
    top: 70px;
    right: -400px;
    width: 350px;
    height: calc(100% - 100px);
    background: #011426dd;
    box-shadow: -5px 0 20px #00ffffaa;
    backdrop-filter: blur(10px);
    padding: 1.5rem 2rem;
    border-radius: 15px 0 0 15px;
    transition: right 0.4s ease;
    color: #0ff;
    overflow-y: auto;
    z-index: 100;
  }
  #settingsPanel.open {
    right: 0;
  }
  #settingsPanel h2 {
    margin-bottom: 1rem;
    text-align: center;
    font-weight: 900;
    font-size: 2rem;
    text-shadow: 0 0 10px #00ffffbb;
  }
  #closeSettings {
    position: absolute;
    top: 1rem;
    right: 1rem;
    cursor: pointer;
    font-size: 1.8rem;
  }
  label {
    display: block;
    margin: 1rem 0 0.5rem 0;
    font-weight: 700;
    font-size: 1.1rem;
  }
  input[type="text"], input[type="password"] {
    width: 100%;
    padding: 0.7rem 1rem;
    border-radius: 10px;
    border: none;
    background: #022b40;
    color: #0ff;
    font-size: 1.1rem;
    box-shadow: inset 0 0 10px #00ffffaa;
  }
  input[type="checkbox"] {
    margin-right: 0.5rem;
    transform: scale(1.2);
    cursor: pointer;
  }
  button {
    margin-top: 1.5rem;
    padding: 0.8rem 1.3rem;
    border-radius: 25px;
    border: none;
    background: #00fff7;
    color: #000;
    font-weight: 800;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 0 20px #00fff7;
    transition: transform 0.3s ease;
  }
  button:hover {
    transform: scale(1.1);
  }
  /* -- LOGIN INFO -- */
  #userInfo {
    margin-top: 1rem;
    font-weight: 700;
    font-size: 1rem;
    color: #0ff;
    text-align: center;
  }
  /* -- DARK MODE -- */
  body.light {
    background: #f0f8ff;
    color: #111;
  }
  body.light header {
    background: #a0eaff;
    box-shadow: 0 0 15px #00aaff;
  }
  body.light #chatBox {
    background: #e6f7ff;
    box-shadow: inset 0 0 15px #00aaffaa;
    color: #111;
  }
  body.light .userMessage {
    background: linear-gradient(120deg, #66ccff, #00aaff);
    color: #111;
  }
  body.light .botMessage {
    background: linear-gradient(120deg, #ccefff, #99d9ff);
    color: #222;
  }
  body.light #userInput {
    background: #ccefff;
    color: #111;
    box-shadow: inset 0 0 10px #00aaffaa;
  }
  body.light #sendBtn {
    background: #00aaff;
    color: #fff;
    box-shadow: 0 0 15px #00aaff;
  }
  body.light #settingsPanel {
    background: #ccf4ffcc;
    color: #111;
    box-shadow: -5px 0 20px #00aaffaa;
  }
  /* -- Animations */
  @keyframes fadeIn {
    0% {opacity: 0; transform: translateY(10px);}
    100% {opacity: 1; transform: translateY(0);}
  }
  /* -- Scrollbar -- */
  #chatBox::-webkit-scrollbar {
    width: 8px;
  }
  #chatBox::-webkit-scrollbar-thumb {
    background: #00fff7aa;
    border-radius: 4px;
  }
  /* -- Responsive -- */
  @media (max-width: 500px) {
    main {
      margin: 90px 10px 20px 10px;
      padding: 1rem;
    }
    #settingsPanel {
      width: 100%;
      height: 50%;
      bottom: 0;
      top: auto;
      border-radius: 15px 15px 0 0;
      right: -100%;
      transition: right 0.3s ease;
    }
    #settingsPanel.open {
      right: 0;
    }
  }
</style>
</head>
<body>

<header>
  <h1>ðŸ’» Code Bot</h1>
  <div id="settingsBtn" title="Settings" aria-label="Settings" tabindex="0">&#9881;</div>
</header>

<main>
  <div id="chatBox" role="log" aria-live="polite" aria-relevant="additions"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Ask me anything about coding..." autocomplete="off" />
    <button id="sendBtn" aria-label="Send message">Send</button>
  </div>
</main>

<aside id="settingsPanel" aria-hidden="true" aria-label="Settings panel">
  <div id="closeSettings" title="Close Settings" aria-label="Close Settings" tabindex="0">&times;</div>
  <h2>Settings</h2>
  
  <label for="apiKeyInput">OpenAI API Key</label>
  <input type="password" id="apiKeyInput" placeholder="Paste your OpenAI API key here" autocomplete="off" />
  
  <label for="firebaseApiKey">Firebase API Key</label>
  <input type="text" id="firebaseApiKey" placeholder="Your Firebase API Key" autocomplete="off" />
  
  <label for="firebaseAuthDomain">Firebase Auth Domain</label>
  <input type="text" id="firebaseAuthDomain" placeholder="Your Firebase Auth Domain" autocomplete="off" />
  
  <label for="firebaseProjectId">Firebase Project ID</label>
  <input type="text" id="firebaseProjectId" placeholder="Your Firebase Project ID" autocomplete="off" />
  
  <label for="firebaseAppId">Firebase App ID</label>
  <input type="text" id="firebaseAppId" placeholder="Your Firebase App ID" autocomplete="off" />
  
  <button id="saveSettingsBtn">Save & Initialize</button>
  
  <hr style="margin: 1.5rem 0; border-color: #00fff7aa;">
  
  <button id="googleLoginBtn" style="background:#4285F4;color:#fff;">Sign in with Google</button>
  
  <div id="userInfo"></div>
  
  <hr style="margin: 1.5rem 0; border-color: #00fff7aa;">
  
  <label><input type="checkbox" id="darkModeToggle" /> Enable Dark Mode</label>
</aside>

<script type="module">
  // == UTILS ==
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }

  // == DOM ==
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsPanel = document.getElementById('settingsPanel');
  const closeSettings = document.getElementById('closeSettings');
  const chatBox = document.getElementById('chatBox');
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const apiKeyInput = document.getElementById('apiKeyInput');
  const saveSettingsBtn = document.getElementById('saveSettingsBtn');
  const googleLoginBtn = document.getElementById('googleLoginBtn');
  const userInfo = document.getElementById('userInfo');
  const darkModeToggle = document.getElementById('darkModeToggle');

  // -- Firebase variables
  let firebaseApp = null;
  let firebaseAuth = null;
  let currentUser = null;

  // == TOGGLE SETTINGS PANEL ==
  function toggleSettings() {
    const open = settingsPanel.classList.toggle('open');
    settingsPanel.setAttribute('aria-hidden', open ? 'false' : 'true');
  }
  settingsBtn.addEventListener('click', toggleSettings);
  closeSettings.addEventListener('click', toggleSettings);
  settingsBtn.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') toggleSettings();
  });
  closeSettings.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') toggleSettings();
  });

  // == Dark Mode ==
  function loadDarkMode() {
    const saved = localStorage.getItem('darkMode');
    if (saved === 'true') {
      document.body.classList.add('light');
      darkModeToggle.checked = true;
    }
  }
  function toggleDarkMode() {
    if (darkModeToggle.checked) {
      document.body.classList.add('light');
      localStorage.setItem('darkMode', 'true');
    } else {
      document.body.classList.remove('light');
      localStorage.setItem('darkMode', 'false');
    }
  }
  darkModeToggle.addEventListener('change', toggleDarkMode);
  loadDarkMode();

  // == Initialize Firebase App ==
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  function initFirebase(config) {
    if(firebaseApp) {
      firebaseApp.delete(); // cleanup old app
      firebaseApp = null;
      firebaseAuth = null;
    }
    firebaseApp = initializeApp(config);
    firebaseAuth = getAuth(firebaseApp);
    onAuthStateChanged(firebaseAuth, (user) => {
      currentUser = user;
      if(user) {
        userInfo.textContent = `Logged in as: ${user.email} `;
        googleLoginBtn.textContent = "Sign out";
      } else {
        userInfo.textContent = "Not logged in";
        googleLoginBtn.textContent = "Sign in with Google";
      }
    });
  }

  // == Google Login/Logout ==
  googleLoginBtn.addEventListener('click', async () => {
    if (!firebaseAuth) {
      alert("Initialize Firebase first!");
      return;
    }
    if(currentUser) {
      await signOut(firebaseAuth);
    } else {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(firebaseAuth, provider);
      } catch (err) {
        alert("Login error: " + err.message);
      }
    }
  });

  // == Save settings and init Firebase ==
  saveSettingsBtn.addEventListener('click', () => {
    const config = {
      apiKey: document.getElementById('firebaseApiKey').value.trim(),
      authDomain: document.getElementById('firebaseAuthDomain').value.trim(),
      projectId: document.getElementById('firebaseProjectId').value.trim(),
      appId: document.getElementById('firebaseAppId').value.trim(),
    };
    if (!config.apiKey || !config.authDomain || !config.projectId || !config.appId) {
      alert("Fill all Firebase config fields!");
      return;
    }
    initFirebase(config);
    alert("Firebase Initialized! You can now login.");
  });

  // == CHAT AI ==

  let OPENAI_API_KEY = '';
  apiKeyInput.addEventListener('input', e => {
    OPENAI_API_KEY = e.target.value.trim();
  });

  // Append message to chat box
  function appendMessage(text, sender='bot') {
    const div = document.createElement('div');
    div.classList.add('message');
    div.classList.add(sender === 'user' ? 'userMessage' : 'botMessage');
    div.textContent = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // Fetch AI response from OpenAI API
  async function getAIResponse(prompt) {
    if (!OPENAI_API_KEY) {
      return "Please enter your OpenAI API key in settings.";
    }
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + OPENAI_API_KEY
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{role: "user", content: prompt}],
          max_tokens: 500,
          temperature: 0.7
        })
      });
      if(!response.ok) {
        return `OpenAI API Error: ${response.status} ${response.statusText}`;
      }
      const data = await response.json();
      return data.choices[0].message.content.trim();
    } catch (e) {
      return "Network error, try again.";
    }
  }

  // Send message on button click or enter key
  async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;
    appendMessage(text, 'user');
    userInput.value = '';
    appendMessage("Typing...", 'bot');

    const messages = Array.from(chatBox.children);
    let promptMessages = messages
      .map(m => `${m.classList.contains('userMessage') ? "User" : "Bot"}: ${m.textContent}`)
      .join('\n');

    let answer = await getAIResponse(promptMessages + `\nUser: ${text}\nBot:`);

    // Remove "Typing..." message before adding real response
    let typingElem = Array.from(chatBox.children).find(el => el.textContent === "Typing...");
    if(typingElem) chatBox.removeChild(typingElem);

    appendMessage(answer, 'bot');
  }

  sendBtn.addEventListener('click', sendMessage);
  userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // On load
  appendMessage("Welcome to Code Bot! Enter your OpenAI API key in Settings to start chatting.");

  // NOTE: Your domain: https://glizzyguy09.github.io
</script>

</body>
</html>
